USE accounting;

DROP PROCEDURE IF EXISTS GetCompanyData;
DELIMITER //
CREATE PROCEDURE GetCompanyData()
BEGIN
    SELECT 
        mt.TransactionType,
        DATE_FORMAT(mtd.TransactionDate, '%b') AS TransactionMonth,   -- Abbreviated month format (MMM)
        EXTRACT(YEAR FROM mtd.TransactionDate) AS TransactionYear,    -- Extracting year
        SUM(mtd.Cost) AS Cost,
        SUM(mtd.Quantity) AS Quantity
    FROM 
        moduletransaction mt
    JOIN 
        ModuleTransactionDusersusersetails mtd ON mt.transactionid = mtd.transactionid
    JOIN 
        users u ON u.userid = mtd.userid
    WHERE 
        u.userid = 1
    GROUP BY 
        mt.TransactionType,
        TransactionMonth,   -- Use the alias for better clarity
        TransactionYear;    -- Use the alias for better clarity
END //

DELIMITER ;
